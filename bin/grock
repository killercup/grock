#!/usr/bin/env node
'use strict';

var START = process.hrtime();

require('coffee-script');
var path = require('path');
var fs = require('fs');
var  _ = require('lodash');

var optimist = require('optimist')
  .usage('Usage: $0 --src [string]')
  .default('src', 'lib/*.coffee')
  .describe('src', 'Set glob to match source files')
  .default('style', 'solarized')
  .describe('style', 'Set the output style/theme')
  .boolean('verbose')
  .default('verbose', false)
  .alias('v', 'verbose')
  .describe('verbose', 'Show more log output')
  .default('index', 'Readme.md')
  .describe('index', 'File to be used as index')
  .alias('i', 'index')
  ;

if (optimist.argv.h) {
  optimist.showHelp();
  process.exit(2);
}

var projectConfig;
var projectConfigPath = path.resolve('.groc.json');

try {
  projectConfig = JSON.parse(fs.readFileSync(projectConfigPath));
} catch (e) {
  projectConfig = {};
}

var argv = _.defaults({
  src: projectConfig.glob || projectConfig.src
}, optimist.argv);

var generator = require('../lib/generator');

argv.start = START;

generator(argv);
